<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:DriverLogisticsApp.ViewModels"
             xmlns:models="clr-namespace:DriverLogisticsApp.Models.ExpenseTypes"
             x:Class="DriverLogisticsApp.Views.AllExpensesPage"
             Title="All Expenses"
             x:DataType="viewmodels:AllExpensesViewModel">
    <ContentPage.ToolbarItems>
        <ToolbarItem Text="Add Expense" Command="{Binding GoToAddExpenseCommand}" />
    </ContentPage.ToolbarItems>
    <Grid>
        <ListView ItemsSource="{Binding Expenses}"
                  IsPullToRefreshEnabled="True"
                  RefreshCommand="{Binding LoadExpensesCommand}"
                  IsRefreshing="{Binding IsBusy, Mode=OneWay}"
                  SelectionMode="None">
            <ListView.ItemTemplate>
                <DataTemplate x:DataType="models:Expense">
                    <ViewCell>
                        <Grid Padding="10">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            <VerticalStackLayout Grid.Column="0">
                                <Label Text="{Binding FormattedDetails}" FontAttributes="Bold" />
                                <Label Text="{Binding Amount, StringFormat='{0:C}'}" />
                            </VerticalStackLayout>
                            <Button Grid.Column="1" Text="Details" Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:AllExpensesViewModel}}, Path=GoToExpenseDetailsCommand}" CommandParameter="{Binding .}" />
                        </Grid>
                    </ViewCell>
                </DataTemplate>
            </ListView.ItemTemplate>
        </ListView>
    </Grid>
</ContentPage>
